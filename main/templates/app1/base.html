<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Profile Page</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #f4f6f9;
      font-family: 'Vazir', sans-serif;
    }
    @font-face {
      font-family: 'Vazir';
      src: url('Vazir.eot'); /* IE9 Compat Modes */
      src: url('fonts/Vazir-Regular-UI.ttf') format('truetype');
    }
    .page-title {
      background: linear-gradient(to right, #4a90e2, #50c878);
      color: white;
      text-align: center;
      padding: 15px 0;
      border-radius: 10px 10px 0 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-size: 1.5rem;
      width: 100%;
    }
    .status-indicator {
      width: 100%;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      border-radius: 5px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }
    .status-stopped {
      background-color: #ff6b6b;
      color: white;
    }
    .status-started {
      background-color: #52cd4e;
      color: white;
    }
    .status-completed {
      background-color: #4ecdc4;
      color: white;
    }
    .status-unknown {
      background-color: #b7b7b7;
      color: white;
    }
    .main-content {
      background-color: white;
      border-radius: 0 0 15px 15px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      min-height: 400px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
    }
    .buttons-middle {
      flex: 1;
    }
    .sidebar-buttons {
      width: 250px;
      background-color: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      transform: translateX(10px);
    }
    .middle-buttons .my-button {
        position: relative;
      width: 100%;
      text-align: center;
      background-color: #f8f9fa;
      color: #495057;
      border: 1px solid #ced4da;
      border-radius: 10px;
      padding: 15px 30px;
      font-size: 15px;
      cursor: pointer;
      direction: rtl;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1.5;
      margin-bottom: 10px;
      min-height: 150px;
      transition: all 0.3s ease;
    }
    .middle-buttons .my-button:hover {
      background-color: #e2e6ea;
      transform: scale(1.02);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .sidebar-buttons .my-button {
      width: 100%;
      text-align: center;
      background-color: #f8f9fa;
      color: #495057;
      border: 1px solid #ced4da;
      border-radius: 10px;
      padding: 15px 30px;
      font-size: 15px;
      cursor: pointer;
      direction: rtl;
      display: block;
      line-height: 1.5;
      margin-bottom: 10px;
      min-height: 70px;
      transition: all 0.3s ease;
    }
    .sidebar-buttons .my-button:hover {
      background-color: #e2e6ea;
      transform: scale(1.02);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .col-6 {
      margin-bottom: 20px;
    }
    .title-link a{
      text-decoration: none;
      color: inherit;
    }
.main-link {
  display: flex;
  text-decoration: none;
  color: inherit;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}
.modern-select {
  appearance: none;
  -webkit-appearance: none;
  padding: 0rem 1rem;
  font-size: 0.95rem;
  height: 37px;
  background-color: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  color: #374151;
  transition: all 0.2s;
  cursor: pointer;
  outline: none;
  position: relative;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.modern-select:focus {
  border-color: #6366f1;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
  background-color: #ffffff;
}

.modern-select:hover {
  background-color: #f3f4f6;
}

/* Custom arrow for select using background image */
.modern-select {
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23606060%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
  background-repeat: no-repeat;
  background-position: right 0.7rem top 50%;
  background-size: 0.65rem auto;
  padding-right: 2.5rem;
}

/* Selected option style */
.modern-select option {
  background-color: #ffffff;
  color: #374151;
  padding: 10px;
}
    {% block additional_style %}
    {% endblock %}
  </style>

</head>
<body>
  <div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center">
    <div class="row w-100 mt-n5">
      <div class="col-12 col-md-8 mx-auto p-0">
        <div class="page-title title-link">{% block title %}{% endblock %}</div>
        <div class="main-content">

            {% block content %}
            {% endblock %}

          <div class="sidebar-buttons">
            <!-- Dropdown: متقاضی های ذخیره شده -->
            <div class="dropdown">
              <button class="my-button dropdown-toggle" type="button" id="customerDropdown" data-bs-toggle="dropdown" aria-expanded="false">متقاضی های ذخیره شده</button>
              <ul class="dropdown-menu" id="customer-list" aria-labelledby="customerDropdown" style="direction: rtl;">
                {% if not request.user.is_superuser %}
                  {% for customer in user.customers.all %}
                    <li><a class="dropdown-item text-end" href="{% url 'user:profile' %}?customer={{ customer.id }}">{% if customer.first_name and customer.last_name %}{{ customer.first_name }} {{ customer.last_name }} - {{ customer.username }}{% else %}کاربر {{ forloop.counter }} - {{ customer.username }}{% endif %}</a></li>
                  {% endfor %}
               {% endif %}
              </ul>
            </div>
            <button class="my-button"><a href="{% url 'user:customers-list' %}?customer={{ customer.id }}" class="main-link">لیست متقاضی های ثبت شده</a></button>
            <button class="my-button" type="submit"><a href="{% url 'user:add-customer' %}?customer={{ customer.id }}" class="main-link">فرم</a></button>
            <button class="my-button"><a href="{% url 'main:licence-time' %}?customer={{ customer.id }}" class="main-link" >زمان لایسنس</a></button>
            <button class="my-button"><a href="{% url 'user:edit-customer' %}?{{ request.GET.urlencode }}" class="main-link">ویرایش مشخصات</a>
            </button>
<form id="logoutForm" action="{% url 'user:logout' %}" method="GET">
  {% csrf_token %}
  <button type="submit" class="my-button main-link">خروج</button>
</form>
<script>
  //remove refresh token and access token
  document.getElementById('logoutForm').addEventListener('submit', function() {
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('access_token');
  });
</script>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <!--fill ul with all available users if current user is superuser, otherwise it will fill by django template -->
{% if request.user.is_superuser %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      fetch("{% url 'user:all_users_json' %}")
        .then(response => response.json())
        .then(data => {
          const customerList = document.getElementById('customer-list');
          data.customers.forEach(customer => {
            const li = document.createElement('li');
            li.innerHTML = `<a class="dropdown-item text-end" href="{% url 'user:profile' %}?customer=${customer.id}">${customer.display_name}</a>`;
            customerList.appendChild(li);
          });
        })
        .catch(error => console.error('Error fetching customers:', error));
    });
  </script>
{% endif %}
</body>
</html>